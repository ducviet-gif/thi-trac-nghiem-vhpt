<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng √¥n t·∫≠p K76.A03 - VƒÉn ho√° Ph√°t tri·ªÉn</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --secondary: #27ae60; --danger: #e74c3c; --accent: #2980b9; --light: #f4f7f6; }
        
        /* C·∫•u h√¨nh Font ch·ªØ to to√†n h·ªá th·ªëng */
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--light); margin: 0; padding: 10px; color: #1a1a1a; font-size: 18px; }
        .container { max-width: 1150px; margin: 0 auto; background: white; padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        
        /* Header th√¥ng tin m√¥n h·ªçc */
        .header-info { text-align: center; margin-bottom: 20px; border-bottom: 3px double var(--primary); padding-bottom: 10px; }
        .header-info h1 { margin: 0; color: var(--primary); font-size: 32px; text-transform: uppercase; }
        .header-info h2 { margin: 5px 0; color: var(--accent); font-size: 26px; }
        .header-info h3 { margin: 0; color: #666; font-size: 20px; }

        nav { display: flex; gap: 8px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; flex-wrap: wrap; justify-content: center; }
        button { padding: 10px 18px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        .btn-main { background: var(--primary); color: white; }
        .btn-sub { background: var(--accent); color: white; }
        .btn-lesson { background: #8e44ad; color: white; }
        .btn-import { background: var(--secondary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .hidden { display: none; }

        /* K·∫øt qu·∫£ hi·ªÉn th·ªã tr√™n c√πng n·ªïi b·∫≠t */
        .result-header { background: #fff9c4; border: 3px solid #fbc02d; padding: 15px; margin-bottom: 15px; border-radius: 8px; text-align: center; display: none; }
        .result-header h2 { margin: 0; font-size: 28px; color: #d32f2f; }

        /* C√¢u h·ªèi v√† N√∫t t√≠ch c·ª±c l·ªõn */
        .q-block { border: 1px solid #cfd8dc; padding: 12px 18px; margin: 8px 0; border-radius: 8px; background: #fff; }
        .q-block p { margin: 0 0 10px 0; font-weight: 700; line-height: 1.5; font-size: 20px; color: #0d47a1; }
        
        .option-item { display: flex; align-items: center; margin: 6px 0; cursor: pointer; padding: 6px 10px; border-radius: 6px; border: 1px solid transparent; }
        .option-item:hover { background: #e3f2fd; border-color: #bbdefb; }
        
        /* Ph√≥ng to n√∫t t√≠ch */
        input[type="radio"] { 
            width: 26px; height: 26px; margin: 0 15px 0 0; cursor: pointer; flex-shrink: 0; 
        }
        .option-text { font-size: 18px; line-height: 1.2; }

        .correct-ans { background: #e8f5e9 !important; border-left: 6px solid #2e7d32; }
        .wrong-ans { background: #ffebee !important; border-left: 6px solid #c62828; }

        .selector-group { background: #f5f5f5; padding: 10px; border-radius: 6px; margin-bottom: 10px; }
        .set-selector { display: flex; gap: 6px; flex-wrap: wrap; }
        .set-btn { background: #fff; border: 1px solid #999; padding: 5px 12px; border-radius: 4px; font-size: 14px; }
        .set-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* B·∫£ng qu·∫£n l√Ω g·ªçn g√†ng */
        .table-wrapper { max-height: 450px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; font-size: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #eceff1; position: sticky; top: 0; z-index: 10; }
        .stt-col { width: 45px; text-align: center; font-weight: bold; background: #f5f5f5; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-info">
        <h1>H·ªá th·ªëng √¥n t·∫≠p thi tr·∫Øc nghi·ªám</h1>
        <h2>M√¥n: VƒÉn ho√° Ph√°t tri·ªÉn</h2>
        <h3>L·ªõp: K76.A03</h3>
    </div>

    <nav>
        <button class="btn-main" onclick="showSection('quiz-random')">üé≤ THI NG·∫™U NHI√äN</button>
        <button class="btn-sub" onclick="showSection('quiz-sequential')">üî¢ THEO B·ªò ƒê·ªÄ</button>
        <button class="btn-lesson" onclick="showSection('quiz-lesson')">üìñ THEO B√ÄI H·ªåC</button>
        <button class="btn-main" onclick="showSection('all-sets')">üìö XEM T·∫§T C·∫¢ C√ÇU H·ªéI</button>
        <button class="btn-import" onclick="showSection('manage')">‚öôÔ∏è QU·∫¢N L√ù D·ªÆ LI·ªÜU</button>
    </nav>

    <div id="top-result" class="result-header">
        <div id="result-text"></div>
        <button class="btn-sub" style="margin-top:10px" onclick="resetQuiz()">L√ÄM ƒê·ªÄ KH√ÅC</button>
    </div>

    <div id="section-quiz-lesson" class="section hidden">
        <div class="selector-group">
            <div style="margin-bottom:5px; font-weight:bold; font-size:14px;">CH·ªåN B√ÄI:</div>
            <div class="set-selector" id="lesson-buttons"></div>
        </div>
        <div id="lesson-content"></div>
        <button class="btn-main hidden" id="submit-lesson" onclick="submitQuiz('lesson')">N·ªòP B√ÄI KI·ªÇM TRA</button>
    </div>

    <div id="section-quiz-random" class="section">
        <div id="random-content"></div>
        <button class="btn-main" id="submit-random" onclick="submitQuiz('random')">N·ªòP B√ÄI KI·ªÇM TRA</button>
    </div>

    <div id="section-quiz-sequential" class="section hidden">
        <div class="selector-group">
            <div style="margin-bottom:5px; font-weight:bold; font-size:14px;">CH·ªåN NH√ìM 10 C√ÇU:</div>
            <div class="set-selector" id="set-buttons"></div>
        </div>
        <div id="sequential-content"></div>
        <button class="btn-main hidden" id="submit-seq" onclick="submitQuiz('seq')">N·ªòP B√ÄI KI·ªÇM TRA</button>
    </div>

    <div id="section-all-sets" class="section hidden">
        <div id="sets-container"></div>
    </div>

    <div id="section-manage" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; background: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
            <div>
                <label style="font-weight:bold;">T·∫£i file Excel: </label>
                <input type="file" id="excel-file" accept=".xlsx, .xls, .csv">
                <button class="btn-import" onclick="importExcel()">NH·∫¨P D·ªÆ LI·ªÜU</button>
            </div>
            <button class="btn-danger" onclick="clearAllData()">üóëÔ∏è X√ìA S·∫†CH D·ªÆ LI·ªÜU C≈®</button>
        </div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th class="stt-col">STT</th><th>B√†i</th><th>C√¢u h·ªèi</th><th>ƒê√°p √°n</th><th>X√≥a</th></tr></thead>
                <tbody id="manage-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
let db = JSON.parse(localStorage.getItem('quiz_db_v7')) || [];
let currentQuestions = [];

function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    document.getElementById('section-' + id).classList.remove('hidden');
    document.getElementById('top-result').style.display = 'none';
    if(id === 'manage') renderManage();
    if(id === 'all-sets') renderAllSets();
    if(id === 'quiz-random') startRandomQuiz();
    if(id === 'quiz-sequential') renderSetSelectors();
    if(id === 'quiz-lesson') renderLessonSelectors();
}

function saveDB() { localStorage.setItem('quiz_db_v7', JSON.stringify(db)); }

function renderManage() {
    const body = document.getElementById('manage-body');
    body.innerHTML = db.length === 0 ? '<tr><td colspan="5" style="text-align:center">Kho c√¢u h·ªèi ƒëang tr·ªëng. Vui l√≤ng nh·∫≠p Excel.</td></tr>' : 
    db.map((q, i) => `
        <tr><td class="stt-col">${i+1}</td><td>${q.b√†i}</td><td>${q.q}</td><td style="text-align:center; font-weight:bold; color:red">${q.ans}</td>
        <td><button class="btn-danger" style="padding:4px 8px" onclick="deleteItem(${i})">X</button></td></tr>
    `).join('');
}

function deleteItem(i) { if(confirm("X√≥a c√¢u n√†y?")) { db.splice(i, 1); saveDB(); renderManage(); } }

function clearAllData() { if(confirm("H√ÄNH ƒê·ªòNG N√ÄY S·∫º X√ìA S·∫†CH TO√ÄN B·ªò C√ÇU H·ªéI. TI·∫æP T·ª§C?")) { db = []; saveDB(); renderManage(); } }

function importExcel() {
    const file = document.getElementById('excel-file').files[0];
    if(!file) return alert("Vui l√≤ng ch·ªçn file Excel!");
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const workbook = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
            const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
            const newQs = json.map(row => ({
                b√†i: row['B√†i'] || '0', q: row['C√¢u h·ªèi'] || '',
                a: row['A'] || '', b: row['B'] || '', c: row['C'] || '', d: row['D'] || '',
                ans: (row['ƒê√°p √°n'] || '').toString().toUpperCase().trim()
            })).filter(q => q.q !== '');
            db = db.concat(newQs); saveDB(); renderManage(); alert("Th√†nh c√¥ng! ƒê√£ n·∫°p th√™m " + newQs.length + " c√¢u h·ªèi.");
        } catch (err) { alert("L·ªói ƒë·ªçc file. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng c·ªôt!"); }
    };
    reader.readAsArrayBuffer(file);
}

function renderLessonSelectors() {
    const container = document.getElementById('lesson-buttons');
    const lessons = [...new Set(db.map(q => q.b√†i))].sort((a,b) => a-b);
    container.innerHTML = lessons.map(l => `<button class="set-btn lesson-btn" onclick="startLessonQuiz('${l}')">B√ÄI ${l}</button>`).join('');
}

function startLessonQuiz(l) {
    currentQuestions = db.filter(q => q.b√†i == l);
    renderQuizArea('lesson-content', 'submit-lesson');
    document.querySelectorAll('.lesson-btn').forEach(b => b.classList.toggle('active', b.innerText === 'B√ÄI ' + l));
}

function startRandomQuiz() {
    if(db.length === 0) return alert("Kho d·ªØ li·ªáu tr·ªëng!");
    currentQuestions = [...db].sort(() => 0.5 - Math.random()).slice(0, 10);
    renderQuizArea('random-content', 'submit-random');
}

function renderSetSelectors() {
    const container = document.getElementById('set-buttons'); container.innerHTML = "";
    for (let i = 0; i < db.length; i += 10) {
        const setNum = Math.floor(i/10) + 1;
        container.innerHTML += `<button class="set-btn seq-btn" onclick="startSequentialQuiz(${i}, ${setNum})">${setNum}</button>`;
    }
}

function startSequentialQuiz(idx, num) {
    currentQuestions = db.slice(idx, idx + 10);
    renderQuizArea('sequential-content', 'submit-seq');
    document.querySelectorAll('.seq-btn').forEach((b, i) => b.classList.toggle('active', i === num - 1));
}

function renderQuizArea(contId, btnId) {
    document.getElementById('top-result').style.display = 'none';
    document.getElementById(btnId).classList.remove('hidden');
    document.getElementById(contId).innerHTML = currentQuestions.map((q, i) => `
        <div class="q-block" id="wrap-${contId}-${i}">
            <p>${i+1}. ${q.q} <small style="color:#777; font-weight:normal;">(B√†i ${q.b√†i})</small></p>
            <label class="option-item"><input type="radio" name="opt-${contId}-${i}" value="A"><span class="option-text">A. ${q.a}</span></label>
            <label class="option-item"><input type="radio" name="opt-${contId}-${i}" value="B"><span class="option-text">B. ${q.b}</span></label>
            <label class="option-item"><input type="radio" name="opt-${contId}-${i}" value="C"><span class="option-text">C. ${q.c}</span></label>
            <label class="option-item"><input type="radio" name="opt-${contId}-${i}" value="D"><span class="option-text">D. ${q.d}</span></label>
        </div>
    `).join('');
}

function submitQuiz(type) {
    const contId = type === 'random' ? 'random-content' : (type === 'seq' ? 'sequential-content' : 'lesson-content');
    const btnId = type === 'random' ? 'submit-random' : (type === 'seq' ? 'submit-seq' : 'submit-lesson');
    let score = 0;
    currentQuestions.forEach((q, i) => {
        const sel = document.querySelector(`input[name="opt-${contId}-${i}"]:checked`);
        const wrap = document.getElementById(`wrap-${contId}-${i}`);
        if(sel && sel.value === q.ans) { score++; wrap.classList.add('correct-ans'); }
        else { wrap.classList.add('wrong-ans'); wrap.innerHTML += `<div style="color:var(--danger); font-weight:bold; margin-top:8px; margin-left:41px; font-size:18px;">=> ƒê√ÅP √ÅN ƒê√öNG: ${q.ans}</div>`; }
    });
    document.getElementById('result-text').innerHTML = `<h2>K·∫æT QU·∫¢ THI: ${score} / ${currentQuestions.length} C√ÇU ƒê√öNG (${Math.round(score/currentQuestions.length*100)}%)</h2>`;
    document.getElementById('top-result').style.display = 'block';
    document.getElementById(btnId).classList.add('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function resetQuiz() { location.reload(); }

function renderAllSets() {
    const container = document.getElementById('sets-container');
    container.innerHTML = `<h2 style="color:var(--primary)">T·ªïng c·ªông: ${db.length} c√¢u h·ªèi trong kho</h2>`;
    for (let i = 0; i < db.length; i += 10) {
        let html = `<div style="background:var(--primary); color:white; padding:8px 15px; font-weight:bold; margin-top:25px; border-radius:5px;">C√ÇU ${i+1} - ${Math.min(i+10, db.length)}</div>`;
        html += db.slice(i, i+10).map((q, idx) => `
            <div class="q-block" style="display:flex; padding:10px 15px;">
                <div class="stt-col" style="margin-right:15px; background:#f0f0f0; border-radius:4px; height:fit-content; padding:5px 10px; font-size:20px;">${i+idx+1}</div>
                <div style="flex:1">
                    <p style="margin-bottom:5px; font-size:19px;">${q.q} <small>(B√†i ${q.b√†i})</small></p>
                    <div style="font-size:16px; color:#444; line-height:1.6;">
                        <span class="${q.ans==='A'?'correct-ans':''}" style="padding:2px 6px">A. ${q.a}</span><br>
                        <span class="${q.ans==='B'?'correct-ans':''}" style="padding:2px 6px">B. ${q.b}</span><br>
                        <span class="${q.ans==='C'?'correct-ans':''}" style="padding:2px 6px">C. ${q.c}</span><br>
                        <span class="${q.ans==='D'?'correct-ans':''}" style="padding:2px 6px">D. ${q.d}</span>
                    </div>
                </div>
            </div>
        `).join('');
        container.innerHTML += html;
    }
}
showSection('quiz-random');
</script>
</body>
</html>